{% extends "base.html" %} {% block title %}Ticket #{{ ticket.id }} - Discord Bot
Manager{% endblock %} {% block extra_head %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/pages/tickets.css') }}"
/>
{% endblock %} {% block content %}
<div class="ticket-view-page">
  <div class="page-header">
    <div>
      <h1>
        <i class="fas fa-ticket-alt"></i>
        Ticket #{{ ticket.id }}
      </h1>
      <p class="subtitle">
        <span
          class="badge badge-{{ 'info' if ticket.ticket_type == 'plex' else 'warning' }}"
        >
          {{ ticket.ticket_type|upper }}
        </span>
        <span
          class="badge badge-{{ 'success' if ticket.status == 'open' else 'secondary' }}"
        >
          {{ ticket.status|upper }}
        </span>
      </p>
    </div>
    <div class="header-actions">
      <a href="{{ url_for('tickets.index') }}" class="btn btn-outline">
        <i class="fas fa-arrow-left"></i> Back to Tickets
      </a>
      {% if ticket.status == 'open' %}
      <button onclick="closeTicket({{ ticket.id }})" class="btn btn-danger">
        <i class="fas fa-times"></i> Close Ticket
      </button>
      {% endif %}
    </div>
  </div>

  <!-- Ticket Details -->
  <div class="card">
    <div class="card-header">
      <h3><i class="fas fa-info-circle"></i> Ticket Information</h3>
    </div>
    <div class="card-body">
      <div class="ticket-details-grid">
        <div class="detail-item">
          <label><i class="fas fa-hashtag"></i> Ticket ID</label>
          <div class="detail-value">#{{ ticket.id }}</div>
        </div>

        <div class="detail-item">
          <label><i class="fas fa-user"></i> User</label>
          <div class="detail-value">{{ ticket.username }}</div>
        </div>

        <div class="detail-item">
          <label><i class="fas fa-hashtag"></i> User ID</label>
          <div class="detail-value">{{ ticket.user_id }}</div>
        </div>

        <div class="detail-item">
          <label><i class="fas fa-tag"></i> Type</label>
          <div class="detail-value">{{ ticket.type or 'N/A' }}</div>
        </div>

        <div class="detail-item">
          <label><i class="fas fa-comment"></i> Channel ID</label>
          <div class="detail-value">{{ ticket.channel_id }}</div>
        </div>

        <div class="detail-item">
          <label><i class="fas fa-calendar-plus"></i> Created</label>
          <div class="detail-value">{{ ticket.created_at or 'N/A' }}</div>
        </div>

        <div class="detail-item">
          <label><i class="fas fa-flag"></i> Status</label>
          <div class="detail-value">
            <span
              class="badge badge-{{ 'success' if ticket.status == 'open' else 'secondary' }}"
            >
              {{ ticket.status|upper }}
            </span>
          </div>
        </div>

        {% if ticket.claimed %}
        <div class="detail-item">
          <label><i class="fas fa-user-check"></i> Claimed By</label>
          <div class="detail-value">{{ ticket.claimed_by or 'N/A' }}</div>
        </div>
        {% endif %} {% if ticket.locked %}
        <div class="detail-item">
          <label><i class="fas fa-lock"></i> Locked</label>
          <div class="detail-value">
            <span class="badge badge-warning">
              <i class="fas fa-lock"></i> LOCKED
            </span>
          </div>
        </div>
        {% endif %} {% if ticket.closed_at %}
        <div class="detail-item">
          <label><i class="fas fa-calendar-times"></i> Closed</label>
          <div class="detail-value">{{ ticket.closed_at }}</div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Discord Channel Link -->
  <div class="card">
    <div class="card-header">
      <h3><i class="fab fa-discord"></i> Discord Channel</h3>
    </div>
    <div class="card-body">
      <p><strong>Channel ID:</strong> {{ ticket.channel_id }}</p>
      <p class="text-muted">
        <i class="fas fa-info-circle"></i>
        You can view this ticket in Discord by navigating to the channel.
      </p>
    </div>
  </div>

  <!-- Actions -->
  {% if ticket.status == 'open' %}
  <div class="card">
    <div class="card-header">
      <h3><i class="fas fa-cog"></i> Actions</h3>
    </div>
    <div class="card-body">
      <div class="action-buttons">
        <button onclick="closeTicket({{ ticket.id }})" class="btn btn-danger">
          <i class="fas fa-times"></i> Close Ticket
        </button>
      </div>
    </div>
  </div>
  {% endif %}
</div>

<script>
  function closeTicket(ticketId) {
    if (!confirm("Are you sure you want to close this ticket?")) {
      return;
    }

    fetch(`/tickets/${ticketId}/close`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          showNotification("Ticket closed successfully", "success");
          setTimeout(() => window.location.reload(), 1000);
        } else {
          showNotification("Error: " + data.message, "error");
        }
      })
      .catch((error) => {
        showNotification("Error closing ticket: " + error, "error");
      });
  }
</script>
{% endblock %}
