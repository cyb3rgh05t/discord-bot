{% extends "base.html" %} {% block title %}{{ table_name }} - Database Browser{%
endblock %} {% block extra_head %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/pages/databases.css') }}"
/>
{% endblock %} {% block content %}
<div class="database-table-page">
  <div class="page-header">
    <div>
      <h1>
        <i class="fas fa-table"></i>
        {{ table_name }}
      </h1>
      <p class="subtitle">
        Database: {{ data.database }}.db | Total rows: {{ data.total }}
      </p>
    </div>
    <div class="header-actions">
      <a href="{{ url_for('databases.index') }}" class="btn btn-outline">
        <i class="fas fa-arrow-left"></i> Back to Databases
      </a>
    </div>
  </div>

  <!-- Table Data -->
  <div class="card">
    <div class="card-header">
      <h3><i class="fas fa-table"></i> Table Data</h3>
      <div class="pagination-info">
        Page {{ data.page }} | {{ data.per_page }} rows per page
      </div>
    </div>
    <div class="card-body">
      {% if data.rows %}
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              {% for column in data.columns %}
              <th>{{ column }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in data.rows %}
            <tr>
              {% for value in row %}
              <td>{{ value if value is not none else '-' }}</td>
              {% endfor %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      {% if data.total > data.per_page %}
      <div class="pagination">
        {% set total_pages = (data.total / data.per_page) | round(0, 'ceil') |
        int %} {% if data.page > 1 %}
        <a
          href="{{ url_for('databases.view_table', table_name=table_name, page=data.page-1) }}"
          class="page-link"
        >
          <i class="fas fa-chevron-left"></i> Previous
        </a>
        {% endif %}

        <span class="page-info">
          Page {{ data.page }} of {{ total_pages }}
        </span>

        {% if data.page < total_pages %}
        <a
          href="{{ url_for('databases.view_table', table_name=table_name, page=data.page+1) }}"
          class="page-link"
        >
          Next <i class="fas fa-chevron-right"></i>
        </a>
        {% endif %}
      </div>
      {% endif %} {% else %}
      <div class="empty-state">
        <i class="fas fa-inbox"></i>
        <h3>No data</h3>
        <p>This table is empty.</p>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Table Schema -->
  <div class="card">
    <div class="card-header clickable-header" onclick="toggleSchema()">
      <h3><i class="fas fa-columns"></i> Table Schema</h3>
      <i class="fas fa-chevron-down expand-icon" id="schema-icon"></i>
    </div>
    <div class="card-body d-none" id="schema-content">
      <div class="schema-table">
        <table class="data-table">
          <thead>
            <tr>
              <th>Column</th>
              <th>Type</th>
              <th>Not Null</th>
              <th>Default</th>
              <th>Primary Key</th>
            </tr>
          </thead>
          <tbody>
            {% for column in schema %}
            <tr>
              <td><strong>{{ column[1] }}</strong></td>
              <td><span class="type-badge">{{ column[2] }}</span></td>
              <td>
                {% if column[3] %}
                <i class="fas fa-check text-success"></i>
                {% else %}
                <i class="fas fa-times text-muted"></i>
                {% endif %}
              </td>
              <td>{{ column[4] if column[4] else '-' }}</td>
              <td>
                {% if column[5] %}
                <i class="fas fa-key text-warning"></i>
                {% else %}
                <i class="fas fa-times text-muted"></i>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
  function toggleSchema() {
    const content = document.getElementById("schema-content");
    const icon = document.getElementById("schema-icon");

    if (content.style.display === "none") {
      content.style.display = "block";
      icon.style.transform = "rotate(180deg)";
    } else {
      content.style.display = "none";
      icon.style.transform = "rotate(0deg)";
    }
  }
</script>
{% endblock %}
